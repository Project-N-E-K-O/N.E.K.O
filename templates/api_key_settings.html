<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="api.settingsTitle">API Key 设置 - Project N.E.K.O.</title>
    <!-- i18next 加载器（统一处理 CDN 加载和初始化） -->
    <script src="/static/i18n-i18next.js"></script>
    <link rel="stylesheet" href="/static/css/api_key_settings.css">
</head>

<body>

    <div id="loading-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div id="voice-preparing-toast" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-image: url('/static/icons/reminder_blue.png');
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
        background-color: transparent;
        color: white;
        padding: 20px 32px;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 600;
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: voiceToastFadeIn 0.3s ease;
        pointer-events: none;
        width: 320px;
        box-sizing: border-box;
        justify-content: center;
    ">
            <div style="
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        "></div>
            <span data-i18n="api.loadingConfig">正在加载配置...</span>
        </div>
    </div>

    <!-- 主内容容器 - 直接显示原有UI，通过遮罩层半透明覆盖 -->
    <div id="main-content">
        <div class="container">
        <div class="container-header">
            <h2 data-i18n="api.settings" data-text="API Key Settings">API Key 设置</h2>
            <button class="close-btn" onclick="closeSettingsPage()" data-i18n-title="common.close"><img src="/static/icons/close_button.png" data-i18n-alt="common.close" style="width: 32px; height: 32px;"></button>
        </div>
            <div class="container-content">
            <div class="api-key-info">
                <h3>
                    <img src="/static/icons/key.png" alt="" style="width: 48px; height: 48px; vertical-align: middle; margin-right: 8px;">
                    <span data-i18n="api.quickStart">快速开始</span>
                </h3>
                <ul>
                    <li><strong data-i18n="api.freeVersion">免费版（推荐新手）：</strong><br><span
                            data-i18n="api.freeVersionDesc">无需注册，在下方高级选项中选择"免费版"即可使用</span></li>
                    <li><strong data-i18n="api.fullVersion">完整版（获取API Key）：</strong></li>
                    <li><em data-i18n="api.fullVersionNote">这只是一个例子，你完全可以使用OpenAI，Gemini或其他选项</em></li>
                    <li>1. <span data-i18n="api.step1">在阿里云注册账号并</span> <a
                            href="https://myaccount.console.aliyun.com/overview" target="_blank"
                            data-i18n="api.step1Link">完成实名认证</a></li>
                    <li>2. <span data-i18n="api.step2">访问阿里云百炼平台</span> <a
                            href="https://bailian.console.aliyun.com/cn-beijing/?tab=model#/api-key" target="_blank"
                            data-i18n="api.step2Link">APIKey管理页面</a></li>
                    <li>3. <span data-i18n="api.step3">创建新的API Key并点击复制按钮</span></li>
                    <li>4. <span data-i18n="api.step4">将API Key粘贴到下方输入框中</span></li>
                </ul>
            </div>



            <div class="section">
                <div class="api-key-info newbie-recommend">
                    <h3>
                        <img src="/static/icons/emotion_model_icon.png" alt="" style="width: 48px; height: 48px; vertical-align: middle; margin-right: 8px;">
                        <span data-i18n="api.newbieRecommendTitle">新手推荐</span>
                    </h3>
                    <div style="color: #40C5F1;">
                        <strong data-i18n="api.newbieRecommend">如果您还没有API
                            Key，可以直接在下方高级选项中选择"免费版"开始使用，无需注册任何账号！</strong>
                    </div>
                </div>
                <div class="api-key-info">
                    <h3>
                        <img src="/static/icons/exclamation.png" alt="" style="width: 48px; height: 48px; vertical-align: middle; margin-right: 8px;">
                        <span data-i18n="api.coreApiKey">核心API Key</span>
                    </h3>
                    <div class="tips" style="color: rgba(64, 197, 241, 0.85); font-weight: normal; margin-bottom: 16px;">
                        <span data-i18n="api.tip">请确保API Key格式正确。保存后需要重启服务才能生效。</span><br>
                        <span data-i18n="api.tip2">个人使用环境，API Key将完整显示以便复制使用。</span>
                    </div>

                    <form id="api-key-form">
                        <div class="field-row">
                            <label for="coreApiSelect">
                                <span data-i18n="api.coreApiProvider">核心API服务商</span>
                                <div class="tooltip-container">
                                    <span class="tooltip-icon">?</span>
                                    <div class="tooltip-content">
                                        <strong data-i18n="api.coreApiTitle">核心API负责对话功能：</strong><br>
                                        • <span data-i18n="api.freeVersionCore">免费版：完全免费，无需API
                                            Key，但不支持自定义语音、Agent模式和视频对话</span><br>
                                        • <span data-i18n="api.aliCore">阿里：有免费额度，功能全面</span><br>
                                        • <span data-i18n="api.glmCore">智谱：有免费额度，但需充值1元，内置联网搜索功能</span><br>
                                        • <span data-i18n="api.stepCore">阶跃星辰：完全免费，但不支持视频</span><br>
                                        • <span data-i18n="api.openaiCore">OpenAI：智能水平最高，但需要翻墙且价格昂贵</span>
                                    </div>
                                </div>
                            </label>
                            <select id="coreApiSelect"
                                style="width: 100%; max-width: 600px; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem;">
                                <!-- 选项将通过 JavaScript 动态加载 -->
                            </select>
                        </div>
                        <div class="field-row">
                            <label style="display: none;"><span data-i18n="api.coreApiKey">核心API Key</span><span id="freeVersionHint"
                                    style="color: #28a745; font-weight: normal; display: none;"
                                    data-i18n="api.freeVersionHint">（免费版无需填写）</span></label>
                            <input type="text" id="apiKeyInput" data-i18n-placeholder="api.coreApiKeyPlaceholder"
                                placeholder="Enter your API Key" required style="max-width: 600px; width: 100%;">
                        </div>

                        <div style="margin-top: 20px;">
                            <button type="submit" id="save-settings-btn">
                                <img src="/static/icons/import_model_button_icon.png" data-i18n-alt="common.save" class="button-icon">
                                <span data-i18n="api.saveSettings">保存设置</span>
                            </button>
                        </div>
                    </form>
                </div>

                <div id="current-api-key" class="status info" style="display: none;"></div>
                <div id="status" class="status"></div>
            </div>

            <div id="advanced-section" class="section" style="margin-top: 0;">
                <button id="advanced-toggle-btn" onclick="toggleAdvancedOptions()">
                    <img src="/static/icons/dropdown_arrow.png" data-i18n-alt="common.expand" class="dropdown-icon">
                    <span data-i18n="api.advancedOptions">高级选项（可选）</span>
                </button>
                <div id="advanced-options" style="display: none;">
                    <div
                        style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 6px; padding: 16px; margin-bottom: 16px; font-size: 0.9em; color: #40C5F1; line-height: 1.6;">
                        <strong data-i18n="api.configSuggestion">配置建议：</strong><br>
                        • <span data-i18n="api.freeVersionSuggestion">免费版：完全免费，无需API
                            Key，适合新手体验（不支持自定义语音、Agent模式和视频对话）</span><br>
                        • <span data-i18n="api.coreApiSuggestion">核心API：负责对话功能，建议根据预算和需求选择</span><br>
                        • <span data-i18n="api.assistApiSuggestion">辅助API：负责记忆管理和自定义语音，只有阿里支持自定义语音</span><br>
                    </div>
                    <div id="assist-api-key-hint"
                        style="background: #d4e8ff; border: 1px solid #a3c9ff; border-radius: 6px; padding: 12px; margin-bottom: 16px; font-size: 0.85em; color: #2a6fc4; line-height: 1.5;">
                        <strong data-i18n="api.assistApiKeyRequiredHint">需在对应的输入框内填写API才能选择其对应的供应商</strong>
                    </div>
                    <div class="field-row">
                        <label for="assistApiSelect">
                            <span data-i18n="api.assistApiProvider">辅助API（记忆管理/自定义语音/文本聊天）</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <div class="tooltip-content">
                                    <strong data-i18n="api.assistApiTitle">辅助API负责记忆管理和自定义语音：</strong><br>
                                    • <span data-i18n="api.freeVersionAssist">免费版：完全免费，无需API Key，但不支持自定义语音</span><br>
                                    • <span data-i18n="api.aliAssist">阿里：推荐选择，支持自定义语音</span><br>
                                    • <span data-i18n="api.glmAssist">智谱：支持Agent模式</span><br>
                                    • <span data-i18n="api.stepAssist">阶跃星辰：价格相对便宜</span><br>
                                    • <span data-i18n="api.siliconAssist">硅基流动：性价比高</span><br>
                                    • <span data-i18n="api.openaiAssist">OpenAI：记忆管理能力强</span><br>
                                    • <span data-i18n="api.geminiAssist">Gemini：智能和性价比极高，但国内版不支持</span><br>
                                    <strong data-i18n="api.assistApiNote">注意：只有阿里支持自定义语音功能</strong>
                                </div>
                            </div>
                        </label>
                        <select id="assistApiSelect"
                            style="width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem;">
                            <!-- 选项将通过 JavaScript 动态加载 -->
                        </select>
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputQwen"><span data-i18n="api.assistApiKeyQwen">辅助API Key -
                                阿里</span><em data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"ali"}'>（仅当辅助API为阿里时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputQwen"
                            data-i18n-placeholder="api.assistApiKeyPlaceholder" placeholder="Optional, defaults to Core API Key" value=""
                            style="max-width: 600px;">
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputOpenai"><span data-i18n="api.assistApiKeyOpenai">辅助API Key -
                                OpenAI</span><em data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"openai"}'>（仅当辅助API为OpenAI时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputOpenai"
                            data-i18n-placeholder="api.assistApiKeyPlaceholder" placeholder="Optional, defaults to Core API Key" value=""
                            style="max-width: 600px;">
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputGlm"><span data-i18n="api.assistApiKeyGlm">辅助API Key - 智谱</span><em
                                data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"glm"}'>（仅当辅助API为智谱时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputGlm" data-i18n-placeholder="api.assistApiKeyPlaceholder"
                            placeholder="Optional, defaults to Core API Key" value="" style="max-width: 600px;">
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputStep"><span data-i18n="api.assistApiKeyStep">辅助API Key -
                                阶跃星辰</span><em data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"step"}'>（仅当辅助API为阶跃星辰时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputStep"
                            data-i18n-placeholder="api.assistApiKeyPlaceholder" placeholder="Optional, defaults to Core API Key" value=""
                            style="max-width: 600px;">
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputSilicon"><span data-i18n="api.assistApiKeySilicon">辅助API Key -
                                硅基流动</span><em data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"silicon"}'>（仅当辅助API为硅基流动时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputSilicon"
                            data-i18n-placeholder="api.assistApiKeyPlaceholder" placeholder="Optional, defaults to Core API Key" value=""
                            style="max-width: 600px;">
                    </div>
                    <div class="field-row">
                        <label for="assistApiKeyInputGemini"><span data-i18n="api.assistApiKeyGemini">辅助API Key -
                                Gemini</span><em data-i18n="api.assistApiKeyHint"
                                data-i18n-params='{"providerKey":"gemini"}'>（仅当辅助API为Gemini时需要填写）</em></label>
                        <input type="text" id="assistApiKeyInputGemini"
                            data-i18n-placeholder="api.assistApiKeyPlaceholder" placeholder="Optional, defaults to Core API Key" value=""
                            style="max-width: 600px;">
                    </div>

                    <!-- MCP Router Token设置（仅保留输入框） -->
                    <div class="field-row" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #6c757d;">
                        <label for="mcpTokenInput">
                            <span data-i18n="api.mcpRouterToken">MCP Router Token</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <div class="tooltip-content">
                                    <strong data-i18n="api.mcpRouterTokenDesc">MCP Router Token说明：</strong><br>
                                    <span data-i18n="api.mcpRouterTokenDescText">用于访问MCP
                                        Router服务的认证令牌，启用MCP功能时需要填写。如果您的MCP Router不需要认证，可以留空。</span>
                                </div>
                            </div>
                            <span
                                style="font-weight: normal; font-size: 0.9em; color: #666; display: block; margin-top: 4px;"><span
                                    data-i18n="api.mcpRouterNoteBefore">当前版本请自行获取并配置</span> <a
                                    href="https://mcp-router.net/" target="_blank" style="color: #4f8cff;">MCP
                                    Router</a><span data-i18n="api.mcpRouterNoteAfter">，后续版本会优化。</span></span>
                        </label>
                        <input type="text" id="mcpTokenInput" data-i18n-placeholder="api.mcpRouterTokenPlaceholder"
                            placeholder="Enter MCP Router Token (optional)" value=""
                            style="width: 100%; max-width: 600px; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; font-family: 'Courier New', monospace;">
                    </div>

                    <!-- 用户自定义API配置（位于高级选项内部最下方） -->
                    <div id="custom-api-section">
                        <button id="custom-api-toggle-btn" onclick="toggleCustomApiSection()">
                            <img src="/static/icons/dropdown_arrow.png" data-i18n-alt="common.expand" class="dropdown-icon">
                            <span data-i18n="api.customApiConfig">自定义API配置</span>
                        </button>
                        <div id="custom-api-options"
                            style="display: none; padding: 12px 0 0 0; border-top: 1px solid #eee;">
                            <div
                                style="background: #f0f8ff; border: 1px solid #b3d9ff; border-radius: 6px; padding: 16px; margin-bottom: 16px; font-size: 0.9em; color: #40C5F1; line-height: 1.5;">
                                <strong data-i18n="api.customApiDescription">自定义API说明：</strong><br>
                                <span
                                    data-i18n="api.customApiDescriptionText">这些API用于特定的功能模块，如摘要生成、文本纠错、情感分析、视觉识别、全模态对话和语音合成。每个API都需要单独配置供应商、URL、模型ID和API
                                    Key。</span><br>
                                <strong data-i18n="api.customApiWarning">
                                    注意：启用自定义API后，将优先使用下方的自定义配置，核心API和辅助API仍可单独调整。</strong>
                            </div>

                            <!-- 启用自定义API开关 -->
                            <div class="custom-api-toggle-wrapper">
                                <input type="checkbox" id="enableCustomApi">
                                <label for="enableCustomApi" class="custom-api-toggle-btn">
                                    <span class="custom-api-toggle-icon"></span>
                                    <span class="custom-api-toggle-text" data-i18n="api.enableCustomApi">启用自定义API配置</span>
                                </label>
                                <div class="custom-api-toggle-note"
                                    data-i18n="api.enableCustomApiNote">
                                    启用后将优先使用自定义API配置，不再强制绑定核心API与辅助API，但仍可手动调整它们
                                </div>
                            </div>

                            <!-- 自定义API折叠容器 -->
                            <div id="custom-api-container" class="custom-api-container" style="display: none;">

                                <!-- 摘要模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('summary')">
                                        <span class="model-title">
                                            <img src="/static/icons/summary_model_icon.png" data-i18n-alt="api.summaryModelConfig" class="model-title-icon">
                                            <span data-i18n="api.summaryModelConfig">摘要模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="summary-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="summaryModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="summaryModelProvider"
                                                data-i18n-placeholder="api.providerExamplePlaceholder"
                                                placeholder="e.g., openai, azure, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="summaryModelUrl" data-i18n="api.apiUrl">API URL</label>
                                            <input type="text" id="summaryModelUrl"
                                                data-i18n-placeholder="api.baseUrlExamplePlaceholder"
                                                placeholder="e.g., https://api.openai.com/v1" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="summaryModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="summaryModelId"
                                                data-i18n-placeholder="api.modelExamplePlaceholder"
                                                placeholder="e.g., gpt-3.5-turbo, qwen-turbo, glm-4-flash" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="summaryModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="summaryModelApiKey"
                                                data-i18n-placeholder="api.summaryApiKeyPlaceholder"
                                                placeholder="Enter Summary API Key" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- 纠错模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('correction')">
                                        <span class="model-title">
                                            <img src="/static/icons/correction_model_icon.png" data-i18n-alt="api.correctionModelConfig" class="model-title-icon">
                                            <span data-i18n="api.correctionModelConfig">纠错模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="correction-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="correctionModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="correctionModelProvider"
                                                data-i18n-placeholder="api.providerExamplePlaceholder"
                                                placeholder="e.g., openai, azure, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="correctionModelUrl" data-i18n="api.apiUrl">API URL</label>
                                            <input type="text" id="correctionModelUrl"
                                                data-i18n-placeholder="api.baseUrlExamplePlaceholder"
                                                placeholder="e.g., https://api.openai.com/v1" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="correctionModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="correctionModelId"
                                                data-i18n-placeholder="api.modelExamplePlaceholder"
                                                placeholder="e.g., gpt-3.5-turbo, qwen-turbo, glm-4-flash" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="correctionModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="correctionModelApiKey"
                                                data-i18n-placeholder="api.correctionApiKeyPlaceholder"
                                                placeholder="Enter Correction API Key" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- 情感模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('emotion')">
                                        <span class="model-title">
                                            <img src="/static/icons/emotion_model_icon.png" data-i18n-alt="api.emotionModelConfig" class="model-title-icon">
                                            <span data-i18n="api.emotionModelConfig">情感模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="emotion-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="emotionModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="emotionModelProvider"
                                                data-i18n-placeholder="api.providerExamplePlaceholder"
                                                placeholder="e.g., openai, azure, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="emotionModelUrl" data-i18n="api.apiUrl">API URL</label>
                                            <input type="text" id="emotionModelUrl"
                                                data-i18n-placeholder="api.baseUrlExamplePlaceholder"
                                                placeholder="e.g., https://api.openai.com/v1" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="emotionModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="emotionModelId"
                                                data-i18n-placeholder="api.modelExamplePlaceholder"
                                                placeholder="e.g., gpt-3.5-turbo, qwen-turbo, glm-4-flash" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="emotionModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="emotionModelApiKey"
                                                data-i18n-placeholder="api.emotionApiKeyPlaceholder"
                                                placeholder="Enter Emotion API Key" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- 视觉模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('vision')">
                                        <span class="model-title">
                                            <img src="/static/icons/vision_model_icon.png" data-i18n-alt="api.visionModelConfig" class="model-title-icon">
                                            <span data-i18n="api.visionModelConfig">视觉模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="vision-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="visionModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="visionModelProvider"
                                                data-i18n-placeholder="api.providerExamplePlaceholder"
                                                placeholder="e.g., openai, azure, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="visionModelUrl" data-i18n="api.apiUrl">API URL</label>
                                            <input type="text" id="visionModelUrl"
                                                data-i18n-placeholder="api.baseUrlExamplePlaceholder"
                                                placeholder="e.g., https://api.openai.com/v1" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="visionModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="visionModelId"
                                                data-i18n-placeholder="api.visionModelExamplePlaceholder"
                                                placeholder="e.g., gpt-4-vision-preview, qwen-vl-plus" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="visionModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="visionModelApiKey"
                                                data-i18n-placeholder="api.visionApiKeyPlaceholder"
                                                placeholder="Enter Vision API Key" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- 全模态模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('omni')">
                                        <span class="model-title">
                                            <img src="/static/icons/omni_model_icon.png" data-i18n-alt="api.realtimeModelConfig" class="model-title-icon">
                                            <span data-i18n="api.realtimeModelConfig">实时模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="omni-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="omniModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="omniModelProvider"
                                                data-i18n-placeholder="api.realtimeProviderExamplePlaceholder"
                                                placeholder="e.g., aliyun, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="omniModelUrl">API URL<em
                                                    data-i18n="api.omniApiUrlNote">（必须是WebSocket地址，以ws://或wss://开头）</em></label>
                                            <input type="text" id="omniModelUrl"
                                                data-i18n-placeholder="api.realtimeWsUrlExamplePlaceholder"
                                                placeholder="e.g., wss://dashscope.aliyuncs.com/api-ws/v1/realtime" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="omniModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="omniModelId"
                                                data-i18n-placeholder="api.realtimeModelExamplePlaceholder"
                                                placeholder="e.g., qwen-realtime-plus" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="omniModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="omniModelApiKey"
                                                data-i18n-placeholder="api.realtimeApiKeyPlaceholder"
                                                placeholder="Enter Realtime API Key" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- TTS模型配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('tts')">
                                        <span class="model-title">
                                            <img src="/static/icons/tts_model_icon.png" data-i18n-alt="api.ttsModelConfig" class="model-title-icon">
                                            <span data-i18n="api.ttsModelConfig">TTS模型配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="tts-model-content" class="model-content">
                                        <div class="field-row">
                                            <label for="ttsModelProvider" data-i18n="api.provider">供应商</label>
                                            <input type="text" id="ttsModelProvider"
                                                data-i18n-placeholder="api.ttsProviderExamplePlaceholder"
                                                placeholder="e.g., aliyun, azure, custom" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="ttsModelUrl" data-i18n="api.apiUrl">API URL</label>
                                            <input type="text" id="ttsModelUrl"
                                                data-i18n-placeholder="api.ttsBaseUrlExamplePlaceholder"
                                                placeholder="e.g., https://dashscope.aliyuncs.com/api/v1/services/aigc/tts/chat"
                                                value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="ttsModelId" data-i18n="api.modelId">模型ID</label>
                                            <input type="text" id="ttsModelId"
                                                data-i18n-placeholder="api.ttsModelExamplePlaceholder"
                                                placeholder="e.g., tts-1, speech-01-turbo" value=""
                                                style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="ttsModelApiKey" data-i18n="api.apiKey">API Key</label>
                                            <input type="text" id="ttsModelApiKey"
                                                data-i18n-placeholder="api.ttsApiKeyPlaceholder"
                                                placeholder="Enter TTS API Key" value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="ttsVoiceId">
                                                <span data-i18n="api.ttsVoiceId">Voice ID</span>
                                                <em data-i18n="api.ttsVoiceIdHint">（可选，角色未设置时的回退音色）</em>
                                            </label>
                                            <input type="text" id="ttsVoiceId"
                                                data-i18n-placeholder="api.ttsVoiceExamplePlaceholder"
                                                placeholder="e.g., Chinese Female, alloy" value="" style="max-width: 600px;">
                                        </div>
                                    </div>
                                </div>

                                <!-- GPT-SoVITS 配置 -->
                                <div class="model-config-container">
                                    <div class="model-header" onclick="toggleModelConfig('gptsovits')">
                                        <span class="model-title">
                                            <img src="/static/icons/tts_model_icon.png" data-i18n-alt="api.gptsovitsConfig" class="model-title-icon">
                                            <span data-i18n="api.gptsovitsConfig">GPT-SoVITS 配置</span>
                                        </span>
                                        <span class="toggle-icon">▼</span>
                                    </div>
                                    <div id="gptsovits-model-content" class="model-content">
                                        <!-- 启用开关 -->
                                        <div class="field-row" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between;">
                                            <label for="gptsovitsEnabled" style="margin-bottom: 0;">
                                                <span data-i18n="api.gptsovitsEnabled">启用 GPT-SoVITS</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsEnabledHint">（启用后将替代上方的 TTS 配置）</em>
                                            </label>
                                            <label class="switch" style="margin-left: 16px;">
                                                <input type="checkbox" id="gptsovitsEnabled" onchange="toggleGptSovitsConfig()">
                                                <span class="slider round"></span>
                                            </label>
                                        </div>
                                        <div id="gptsovits-config-fields">
                                        <div style="background: #fff8e6; border: 1px solid #ffe0b3; border-radius: 6px; padding: 12px; margin: 12px 16px; font-size: 0.85em; color: #996600; line-height: 1.5;">
                                            <strong data-i18n="api.gptsovitsDescription">GPT-SoVITS 说明：</strong><br>
                                            <span data-i18n="api.gptsovitsDescriptionText">本地部署的语音克隆模型，需要先启动 GPT-SoVITS 的 api_v2.py 服务。配置后将自动替代上方的 TTS 模型配置。</span>
                                        </div>
                                        
                                        <!-- 模型加载（最重要，放在最前面） -->
                                        <div class="field-row" style="border-bottom: 1px dashed #ddd; padding-bottom: 12px; margin-bottom: 8px;">
                                            <label style="font-weight: 600; color: #40C5F1;" data-i18n="api.gptsovitsModelLoad">模型加载</label>
                                        </div>
                                        
                                        <div class="field-row">
                                            <label for="gptsovitsBasePath">
                                                <span data-i18n="api.gptsovitsBasePath">GPT-SoVITS 安装路径</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsBasePathHint">（包含 GPT_weights 和 SoVITS_weights 文件夹的目录）</em>
                                            </label>
                                            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
                                                <input type="text" id="gptsovitsBasePath"
                                                    data-i18n-placeholder="api.gptsovitsBasePathPlaceholder"
                                                    placeholder="e.g., /path/to/GPT-SoVITS"
                                                    value="" style="max-width: 500px; flex: 1;">
                                                <button type="button" class="btn secondary" onclick="scanGptSovitsModels()" 
                                                    style="padding: 8px 16px; white-space: nowrap;" data-i18n="api.gptsovitsScanModels">扫描模型</button>
                                            </div>
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsGptModel">
                                                <span data-i18n="api.gptsovitsGptModel">GPT 模型</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsGptModelHint">（选择后点击加载）</em>
                                            </label>
                                            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
                                                <select id="gptsovitsGptModel" style="max-width: 500px; flex: 1; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc;">
                                                    <option value="" data-i18n="api.gptsovitsPleaseSelect">请先扫描模型</option>
                                                </select>
                                                <button type="button" class="btn secondary" onclick="loadGptSovitsGptModel()" 
                                                    style="padding: 8px 16px; white-space: nowrap;" data-i18n="api.gptsovitsLoadModel">加载</button>
                                            </div>
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsSovitsModel">
                                                <span data-i18n="api.gptsovitsSovitsModel">SoVITS 模型</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsSovitsModelHint">（选择后点击加载）</em>
                                            </label>
                                            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
                                                <select id="gptsovitsSovitsModel" style="max-width: 500px; flex: 1; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc;">
                                                    <option value="" data-i18n="api.gptsovitsPleaseSelect">请先扫描模型</option>
                                                </select>
                                                <button type="button" class="btn secondary" onclick="loadGptSovitsSovitsModel()" 
                                                    style="padding: 8px 16px; white-space: nowrap;" data-i18n="api.gptsovitsLoadModel">加载</button>
                                            </div>
                                        </div>

                                        <!-- API 配置 -->
                                        <div class="field-row" style="border-top: 1px dashed #ddd; padding-top: 12px; margin-top: 8px;">
                                            <label style="font-weight: 600; color: #666;" data-i18n="api.gptsovitsApiConfig">API 配置</label>
                                        </div>
                                        
                                        <div class="field-row">
                                            <label for="gptsovitsApiUrl">
                                                <span data-i18n="api.apiUrl">API URL</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsApiUrlOptional">（选填，默认 http://127.0.0.1:9880）</em>
                                            </label>
                                            <input type="text" id="gptsovitsApiUrl"
                                                data-i18n-placeholder="api.gptsovitsApiUrlPlaceholder"
                                                placeholder="http://127.0.0.1:9880"
                                                value="http://127.0.0.1:9880" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="gptsovitsRefAudio">
                                                <span data-i18n="api.gptsovitsRefAudio">参考音频路径</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsRefAudioHint">（GPT-SoVITS 服务器上的绝对路径）</em>
                                            </label>
                                            <input type="text" id="gptsovitsRefAudio"
                                                data-i18n-placeholder="api.gptsovitsRefAudioPlaceholder"
                                                placeholder="e.g., /path/to/reference.wav"
                                                value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="gptsovitsRefText">
                                                <span data-i18n="api.gptsovitsRefText">参考文本</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsRefTextHint">（参考音频对应的文字内容）</em>
                                            </label>
                                            <input type="text" id="gptsovitsRefText"
                                                data-i18n-placeholder="api.gptsovitsRefTextPlaceholder"
                                                placeholder="e.g., Reference audio text content"
                                                value="" style="max-width: 600px;">
                                        </div>
                                        <div class="field-row">
                                            <label for="gptsovitsRefLang" data-i18n="api.gptsovitsRefLang">参考语言</label>
                                            <select id="gptsovitsRefLang" style="max-width: 600px; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc;">
                                                <option value="zh" data-i18n="api.langZh">中文 (zh)</option>
                                                <option value="en" data-i18n="api.langEn">英文 (en)</option>
                                                <option value="ja" data-i18n="api.langJa">日文 (ja)</option>
                                                <option value="all_zh" data-i18n="api.langAllZh">全中文 (all_zh)</option>
                                                <option value="all_ja" data-i18n="api.langAllJa">全日文 (all_ja)</option>
                                            </select>
                                        </div>
                                        <div class="field-row">
                                            <label for="gptsovitsTextLang" data-i18n="api.gptsovitsTextLang">合成语言</label>
                                            <select id="gptsovitsTextLang" style="max-width: 600px; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc;">
                                                <option value="zh" data-i18n="api.langZh">中文 (zh)</option>
                                                <option value="en" data-i18n="api.langEn">英文 (en)</option>
                                                <option value="ja" data-i18n="api.langJa">日文 (ja)</option>
                                                <option value="auto" data-i18n="api.langAuto">自动检测 (auto)</option>
                                            </select>
                                        </div>

                                        <!-- GPT-SoVITS 高级参数 -->
                                        <div class="field-row" style="border-top: 1px dashed #ddd; padding-top: 12px; margin-top: 8px;">
                                            <label style="font-weight: 600; color: #666;" data-i18n="api.gptsovitsAdvanced">高级参数（可选）</label>
                                        </div>
                                        
                                        <div class="field-row">
                                            <label for="gptsovitsSpeed">
                                                <span data-i18n="api.gptsovitsSpeed">语速</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsSpeedHint">（0.5-2.0，默认1.0）</em>
                                            </label>
                                            <input type="number" id="gptsovitsSpeed" step="0.1" min="0.5" max="2.0"
                                                placeholder="1.0" value="" style="max-width: 200px;">
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsTopK">
                                                <span>Top K</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsTopKHint">（采样参数，默认15）</em>
                                            </label>
                                            <input type="number" id="gptsovitsTopK" step="1" min="1" max="100"
                                                placeholder="15" value="" style="max-width: 200px;">
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsTopP">
                                                <span>Top P</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsTopPHint">（采样参数，默认1.0）</em>
                                            </label>
                                            <input type="number" id="gptsovitsTopP" step="0.05" min="0" max="1"
                                                placeholder="1.0" value="" style="max-width: 200px;">
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsTemperature">
                                                <span data-i18n="api.gptsovitsTemperature">温度</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsTemperatureHint">（采样温度，默认1.0）</em>
                                            </label>
                                            <input type="number" id="gptsovitsTemperature" step="0.01"
                                                placeholder="1.0" value="" style="max-width: 200px;">
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsCutMethod" data-i18n="api.gptsovitsCutMethod">文本分割方式</label>
                                            <select id="gptsovitsCutMethod" style="max-width: 300px;">
                                                <option value="cut0" data-i18n="api.cutNone">不切分</option>
                                                <option value="cut1" data-i18n="api.cutEvery4">每4句切一次</option>
                                                <option value="cut2" data-i18n="api.cutEvery50">每50字切一次</option>
                                                <option value="cut3" data-i18n="api.cutByChinese">按中文句号切</option>
                                                <option value="cut4" data-i18n="api.cutByEnglish">按英文句号切</option>
                                                <option value="cut5" selected data-i18n="api.cutByPunctuation">按标点符号切</option>
                                            </select>
                                        </div>

                                        <div class="field-row">
                                            <label for="gptsovitsSeed">
                                                <span data-i18n="api.gptsovitsSeed">随机种子</span>
                                                <em style="font-weight: normal; color: #888;" data-i18n="api.gptsovitsSeedHint">（-1为随机）</em>
                                            </label>
                                            <input type="number" id="gptsovitsSeed" step="1" min="-1"
                                                placeholder="-1" value="" style="max-width: 200px;">
                                        </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 弹出式警告 -->
            <div id="warning-modal" class="modal-overlay" onclick="closeWarningModal()">
                <div class="modal-warning" onclick="event.stopPropagation()">
                    <h3 data-i18n="api.apiKeyChangeWarning.title">⚠️ 重要提醒</h3>
                    <p data-i18n="api.apiKeyChangeWarning.message">检测到您正在更换 API Key，请注意以下事项：</p>
                    <ul>
                        <li data-i18n="api.apiKeyChangeWarning.voiceIdBinding">Voice ID 与您的 API Key 绑定，更换 API Key
                            后所有已注册的 Voice ID 将失效</li>
                        <li data-i18n="api.apiKeyChangeWarning.reRegisterVoice">建议在更换 API Key 后重新注册所需的音色</li>
                    </ul>
                    <div class="modal-buttons">
                        <button type="button" class="btn secondary" onclick="closeWarningModal()"
                            data-i18n="api.apiKeyChangeWarning.cancel">取消</button>
                        <button type="button" class="btn" onclick="confirmApiKeyChange()"
                            data-i18n="api.apiKeyChangeWarning.continue">继续保存</button>
                    </div>
                </div>
            </div>

            </div> <!-- 关闭 container-content -->
        </div> <!-- 关闭 container -->
        </div> <!-- 关闭 main-content -->

    <script src="/static/js/api_key_settings.js"></script>

    <!-- Driver.js 库 -->
    <script src="/static/libs/driver.min.js"></script>
    <link rel="stylesheet" href="/static/libs/driver.min.css">

    <!-- 通用教程管理器 -->
    <script src="/static/universal-tutorial-manager.js"></script>

    <!-- 初始化 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initUniversalTutorialManager === 'function') {
                initUniversalTutorialManager();
            }
        });
    </script>
</body>

</html>