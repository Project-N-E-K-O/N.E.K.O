<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <meta charset="UTF-8">
    <title data-i18n="voice.title">音色注册 - Project N.E.K.O.</title>
    <!-- i18next 加载器（统一处理 CDN 加载和初始化） -->
    <script src="/static/i18n-i18next.js"></script>
    <link rel="stylesheet" href="/static/css/voice_clone.css">
    <link rel="stylesheet" href="/static/css/dark-mode.css">
    <script src="/static/theme-manager.js"></script>
</head>
<body>
    <div class="container">
        <div class="container-header">
            <h2 data-i18n="voice.title" data-text="Voice Registration">音色注册</h2>
            <button class="close-page-btn" onclick="closeVoiceClonePage()" data-i18n-title="common.close">
                <img src="/static/icons/close_button.png" data-i18n-alt="common.close">
            </button>
        </div>
        <div class="container-content">
            <div class="alibaba-api-notice" style="background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%); color: white; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-weight: bold; text-align: center; box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);">
                <span data-i18n="voice.alibabaApiRequired">⚠️ 此功能需要使用阿里云API</span>
            </div>
            <label style="display: flex; align-items: center; gap: 8px;">
                <img src="/static/icons/exclamation.png" alt="" style="width: 48px; height: 48px; flex-shrink: 0;">
                <span data-i18n="voice.selectFile">选择本地音频文件（8秒最佳，请勿超过20秒，wav/mp3格式）</span>
            </label>
            <div class="file-input-wrapper">
                <input type="file" id="audioFile" accept="audio/*">
                <label for="audioFile" class="file-input-label" id="fileInputLabel">
                    <img src="/static/icons/import_model_button_icon.png?v=1" data-i18n-alt="voice.chooseFile" class="file-icon">
                    <span class="file-text" data-i18n="voice.chooseFile" data-text="Choose File">选择文件</span>
                </label>
                <div id="fileNameDisplay" class="file-name-display"></div>
            </div>

            <div class="field-row">
                <label data-i18n="voice.refLanguage">参考音频语言（注意：不是目标音频，是您上传的参考音频的语言）</label>
                <label class="hint" data-i18n="voice.refLanguageNote">选择您上传的参考音频的语言，中文以外的语言需要指定</label>
                <select id="refLanguage" style="max-width: 600px;">
                    <option value="ch" data-i18n="voice.lang.ch">中文</option>
                    <option value="en" data-i18n="voice.lang.en">英语</option>
                    <option value="fr" data-i18n="voice.lang.fr">法语</option>
                    <option value="de" data-i18n="voice.lang.de">德语</option>
                    <option value="ja" data-i18n="voice.lang.ja">日语</option>
                    <option value="ko" data-i18n="voice.lang.ko">韩语</option>
                    <option value="ru" data-i18n="voice.lang.ru">俄语</option>
                </select>
            </div>

            <div class="field-row">
                <label data-i18n="voice.customPrefix">自定义前缀（阿里云需要）</label>
                <input type="text" id="prefix" data-i18n-placeholder="voice.voiceIdPlaceholder"
                    placeholder="Maximum 10 characters, numbers and English letters only" required style="max-width: 600px;">
            </div>

            <input type="hidden" id="lanlan_name" value="">

            <button class="register-voice-btn" onclick="registerVoice()">
                <img src="/static/icons/sound.png" data-i18n-alt="voice.register" class="register-icon">
                <span class="register-text" data-i18n="voice.register" data-text="Register Voice">注册音色</span>
            </button>

            <div class="result" id="result"></div>

            <!-- 已注册音色列表 -->
            <div class="voice-list-section" style="margin-top: 40px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; margin: 0;">
                        <img src="/static/icons/key.png" alt="" style="width: 48px; height: 48px; flex-shrink: 0;">
                        <span data-i18n="voice.registeredVoices" style="color: #40C5F1; font-weight: bold;">已注册音色</span>
                    </label>
                    <button class="btn sm" onclick="loadVoices()" id="refresh-voices-btn">
                        <span data-i18n="voice.refresh">刷新</span>
                    </button>
                </div>
                <div id="voice-list-container" class="voice-list-bg" style="border-radius: 8px; padding: 16px; min-height: 100px; max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; color: #999; padding: 20px;" id="voice-list-loading">
                        <span data-i18n="voice.loading">加载中...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/voice_clone.js"></script>
    <script src="/static/js/voice_silence_remover.js"></script>

    <!-- 智能静音移除模态对话框 -->
    <div id="silenceModal" class="silence-modal-overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="silenceModalTitle">
        <div class="silence-modal">
            <div class="silence-modal-header">
                <h3 id="silenceModalTitle" data-i18n="voice.silenceModal.title">智能空白音频检测结果</h3>
                <button class="silence-modal-close" onclick="closeSilenceModal()" aria-label="Close">&times;</button>
            </div>
            <div class="silence-modal-body">
                <!-- 分析结果 -->
                <div id="silenceAnalysisResult" class="silence-analysis-result">
                    <div class="silence-stat-row">
                        <span class="silence-stat-label" data-i18n="voice.silenceModal.originalDuration">原始音频总时长</span>
                        <span class="silence-stat-value" id="silenceOriginalDuration">--:--</span>
                    </div>
                    <div class="silence-stat-row">
                        <span class="silence-stat-label" data-i18n="voice.silenceModal.silenceDuration">可移除空白总时长</span>
                        <span class="silence-stat-value silence-removable" id="silenceSilenceDuration">--:--</span>
                    </div>
                    <div class="silence-stat-row">
                        <span class="silence-stat-label" data-i18n="voice.silenceModal.estimatedDuration">处理后预计剩余时长</span>
                        <span class="silence-stat-value silence-remaining" id="silenceEstimatedDuration">--:--</span>
                    </div>
                    <div class="silence-stat-row saving-highlight">
                        <span class="silence-stat-label" data-i18n="voice.silenceModal.savingPercentage">节省比例</span>
                        <span class="silence-stat-value" id="silenceSavingPct">0%</span>
                    </div>
                </div>

                <!-- 进度条 (裁剪时显示) -->
                <div id="silenceProgressSection" class="silence-progress-section" style="display: none;">
                    <div class="silence-progress-bar-bg">
                        <div class="silence-progress-bar" id="silenceProgressBar" style="width: 0%;"></div>
                    </div>
                    <div class="silence-progress-text">
                        <span id="silenceProgressPct">0%</span>
                        <span id="silenceProgressPhase" data-i18n="voice.silenceModal.processing">处理中...</span>
                    </div>
                </div>

                <!-- 处理完成后的下载按钮 -->
                <div id="silenceDownloadSection" class="silence-download-section" style="display: none;">
                    <div class="silence-success-msg">
                        <span data-i18n="voice.silenceModal.trimSuccess">✅ 裁剪完成！</span>
                        <span id="silenceMd5" class="silence-md5"></span>
                    </div>
                    <button class="silence-download-btn" id="silenceDownloadBtn" onclick="downloadTrimmedAudio()">
                        <span data-i18n="voice.silenceModal.downloadTrimmed">下载已处理音频</span>
                    </button>
                </div>
            </div>
            <div class="silence-modal-footer" id="silenceModalFooter">
                <button class="silence-btn-trim" id="silenceBtnTrim" onclick="useTrimmedAudio()">
                    <span data-i18n="voice.silenceModal.useTrimmed">使用智能裁剪音频</span>
                </button>
                <button class="silence-btn-original" id="silenceBtnOriginal" onclick="useOriginalAudio()">
                    <span data-i18n="voice.silenceModal.useOriginal">上传原音频</span>
                </button>
                <button class="silence-btn-cancel" id="silenceBtnCancel" onclick="cancelTrimTask()" style="display: none;">
                    <span data-i18n="voice.silenceModal.cancel">取消</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Driver.js 库 -->
    <script src="/static/libs/driver.min.js"></script>
    <link rel="stylesheet" href="/static/libs/driver.min.css">

    <!-- 通用教程管理器 -->
    <script src="/static/universal-tutorial-manager.js"></script>

    <!-- 初始化 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initUniversalTutorialManager === 'function') {
                initUniversalTutorialManager();
            }
        });
    </script>
</body>

</html>